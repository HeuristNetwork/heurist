<html>
 <head>
  <title>HAPI Search sample application</title>

<script src="../php/js/load-hapi.php"></script>
<script src="/hapi/03/goi.js"></script>

<script src="common-functionst.js"></script>

	

<script>
var path ="/heurist/";
var rec_det_id = getParams("id"); 
var t = getParams("t");
var q = urldecode(getParams("q"));
var extra = getParams("ext");

function urldecode (str) {
   if(!str) return null;
   return str = decodeURIComponent(str.replace(/\+/g, '%20')).toString();
}

function getParams (name){
	var regexS = "[\\?&]"+name+"=([^&#]*)";
	var regex = new RegExp( regexS );
	var results = regex.exec( window.location.search );
	if( results == null )
	return;
	else
	return results[1];
}


  
function init() {
    /*
    var recTypes = HRecordTypeManager.getRecordTypes();
	for(var i=recTypes.length-1;i>=0;i--){
		document.getElementById("recTypeDrop").innerHTML += "<option value=\"" +recTypes[i].getID()+"\">"+ recTypes[i].getName()+"</option>";
	}
	*/
    document.getElementById("q").value = q;
    doSearch();
	
}

function doSearch(){
    var strSearch = document.getElementById("q").value;
	if(!strSearch) 
		return;
	var mysearch = new HSearch(strSearch);

		var loader = new HLoader(	
			function(s,r) {
				displayResults(r);
			},
			function(s,e) {
				alert("load failed: " + e);
			});
		HeuristScholarDB.loadRecords(mysearch, loader);
}
	
function displayResults(r){ //empty result brings? Output a message!
	
	
	var div = document.getElementById("sresults");
	
	div.innerHTML = "";
	
	
	if (r.length ==0) div.innerHTML= "No results found";
	for (var i = 0; i < r.length; i++) {
		var recImage = r[i].getRecordType().getID();
		var recId = r[i].getID();
		var recTitle =r[i].getTitle();
		var newdiv = document.createElement('div');
		newdiv.setAttribute("class", "mini-pad");
		newdiv.innerHTML += "<span class=\"clickable\" onClick=\"pickMe("+recId+",'"+recTitle+"',"+rec_det_id+","+extra+");\">" +" <img src=\""+ path +"img/reftype/"+recImage+".gif\" align=absmiddle> " +recTitle +"</span>";
		div.appendChild(newdiv);//append new div right after embedding code div
	}
	
}
	


function pickMe(rid, rtitle, r_d_id, extra){
    var elts = window.opener.document.getElementsByName(r_d_id);
	for (l = 0;  l<elts.length; l++ ){
	if (elts[l].getAttribute("extra") == extra){
	elts[l].value = rtitle;
	elts[l].setAttribute("recid", rid);
	elts[l].onchange();
	}
	}
	window.close();
 
}

function addNewRecord(){
   var recTyprId = document.getElementById("recTypeDrop").options[document.getElementById("recTypeDrop").selectedIndex].value;
   window.open('edit.html?typeId='+recTyprId, '','width=800, height=700, scrollbars=yes');
}


	

	
  </script>
<link rel="stylesheet" type="text/css" href="nyirti_traditional.css">
</head>

	<body onLoad="init();">
		  <h3>Search </h3>
		  <table>
			  <tr class="bg-light">
				  <td class="sub-res-type-ext" nowrap>
				  <form method="post" onSubmit="doSearch(); return false;">
				  Find <input type="text" id="q"  style="width:200px"></input>
				  <input type="submit" name="search" value="search" class="button">
				  </form></td>
				  <td id="rec-type-select-div" class="sub-res-type-ext" style="padding-top:10px" nowrap>
				  <!--
				  <select id="recTypeDrop" /> <input style="margin-left:5px" type="button" value="Add record" id="addRecButton" onClick="addNewRecord()">
				 -->
				  </td>
			  </tr>
			  <tr>
				  <td colspan="2">
				  <div id="sresults"></div>
				
				  </td>
			  </tr>
		  </table>
		  <div class="add-record"></div>
	 </body>

</html>
