<!--

/**
* showReps.html
* List of available report templates based on Smarty
*
* @version 2011.0812
* @author: Artem Osmakov
*
* @copyright (C) 2005-2011 University of Sydney Digital Innovation Unit.
* @link: http://HeuristScholar.org
* @license http://www.gnu.org/licenses/gpl-3.0.txt
* @package Heurist academic knowledge management system
* @todo
**/

-->
<html>
<head>

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title></title>

<!-- yui layout -->

<link rel="stylesheet" type="text/css" href="../../external/yui/2.8.2r1/build/reset-fonts-grids/reset-fonts-grids.css">
<!-- Skin CSS files resize.css must load before layout.css -->
<link rel="stylesheet" type="text/css" href="../../external/yui/2.8.2r1/build/assets/skins/sam/resize.css">
<link rel="stylesheet" type="text/css" href="../../external/yui/2.8.2r1/build/assets/skins/sam/layout.css">
<!-- Utility Dependencies -->
<script src="../../external/yui/2.8.2r1/build/yahoo-dom-event/yahoo-dom-event.js"></script>
<script src="../../external/yui/2.8.2r1/build/dragdrop/dragdrop-min.js"></script>
<script src="../../external/yui/2.8.2r1/build/element/element-min.js"></script>
<!-- Optional Animation Support
<script src="../../external/yui/2.8.2r1/build/animation/animation-min.js"></script> -->
<!-- Optional Resize Support -->
<script src="../../external/yui/2.8.2r1/build/resize/resize-min.js"></script>
<!-- Source file for the Layout Manager -->
<script src="../../external/yui/2.8.2r1/build/layout/layout-min.js"></script>

		<!-- TREEVIEW DEFS -->
		<!-- Required CSS -->
		<link type="text/css" rel="stylesheet" href="../../external/yui/2.8.2r1/build/treeview/assets/skins/sam/treeview.css">
		<!-- Optional dependency source file -->
		<script type="text/javascript" src="../../external/yui/2.8.2r1/build/animation/animation-min.js"></script>
		<!-- Optional dependency source file to decode contents of yuiConfig markup attribute-->
		<script type="text/javascript" src="../../external/yui/2.8.2r1/build/json/json-min.js" ></script>
		<!-- TreeView source file -->
		<script type="text/javascript" src="../../external/yui/2.8.2r1/build/treeview/treeview-min.js" ></script>
		<!-- END TREEVIEW DEFS-->

<script type="text/javascript" src="../../external/jquery/jquery.js"></script>
<script type="text/javascript" src="../../external/tinymce3.4.4/jscripts/tiny_mce/tiny_mce.js"></script>

	<script type="text/javascript">
			var showReps, isEditorVisible=false;
	</script>

<style type="text/css">
body {
	font: 10px Verdana, Geneva, sans-serif;
}

/* hide header in top layout element */
.yui-skin-sam .yui-layout .yui-layout-hd {
	background: none;
	border: 1px solid #808080;
	height: 0px;
	display: none;
}
</style>

</head>

<body class="yui-skin-sam">
		<script type="text/javascript" src="../../common/js/utilsLoad.js"></script>
		<script type="text/javascript" src="../../common/js/utilsUI.js"></script>
		<script type="text/javascript" src="../../viewers/smarty/showReps.js"></script>

		<iframe id="ifrmPrint" src="#" style="width:0px; height:0px;"></iframe>

<!-- position:absolute;top:30px;height:30px; -->
		<div id="toolbar"
			style="width:100%;text-align:left;">
			<div id="rep_list" style="padding-left:10px;display:inline-block;">
				<label style="width:100px">Select template</label>
				<select id="selTemplates" onchange="onSelectTemplate()" style="width:200px;"></select>
				<button onclick="doExecute()">Reload</button>
				<button onclick="onPrint()">Print</button>
				<button onclick="onFile()">Get URL</button>
			</div>
			<div style="text-align: left;float:right;padding-right:10px;">
				<button onclick="onShowEditor()">Edit</button>
				<button onclick="onGenerate()">New Template</button>
			</div>
		</div>


		<div id="layout" style="position:absolute;top:25px;bottom:0px;left:0px;right:0px;">

		<div id="viewercontainer">
			<div id="rep_container" style="overflow:auto;width:100%;"></div>
		</div>

		<div id="editorcontainer">

			<div style="position:absolute; left:0px; right:300px;top:0px;bottom:0px;">
				<div style="height:25px">
					<label style="width:100px">Template</label>
					<input type="text" style="width:200px;" id="edTemplateName"/>
					<button onclick="doEditor(2)">Save</button>
					<button onclick="doEditor(1)">Save As</button>
					<button onclick="doEditor(3)">Delete</button>

				</div>
				<div style="position:absolute;left:0px; right:0px;top:25px;bottom:25px;overflow: auto;">
					<textarea style="width:100%;height:99%;"
						id="edTemplateBody" name="edTemplateBody">efwwefwefe fefwf
					</textarea>
				</div>
				<div style="position:absolute;bottom: 0px;width:100%;">
					<label for="cbDebug">Show debug info</label>
					<input id="cbDebug" type="checkbox"  title="Show debug info"/>
					<div style="text-align:right;position:absolute;right:2px;bottom:2px;">
						<button onclick="doExecute()" title="Test your template" style="font-weight: 800;">Update output below</button>
					</div>
				</div>
			</div>

			<div style="width:300px;position:absolute;right:0px;top:0px;bottom:0px;">
				<div style="height:40px">
					<div>Choose required fields in tree then:</div>
					<!--
					<button onclick="window.showReps.insertSelectedVars(null, false)">Insert fields only</button><br/>
					<button onclick="window.showReps.insertRectypeSection()">All</button>
					<button onclick="window.showReps.insertSelectedVarsAsLoop(null)">Insert fields in loop</button><br/>
					-->
					<label>Style</label>
						<select id="selInsertMode">
							<option value="0">Variable</option>
							<option value="1">Label+Variable</option>
							<option value="2">'Out' function</option>
						</select>
				</div>
				<div id="treeContainer"
					style="position:absolute;left:0px; right:0px;top:40px;bottom:25px;overflow-y: auto;">
					<div id="varsTree" class="ygtv-checkbox"></div>
				</div>
				<div style="position:absolute;bottom: 0px;text-align:right;width:100%;">
					<button onclick="doEditor(0)">Close Editor</button>
				</div>
			</div>


<!--
					<select id="selRectype" onchange="window.showReps.onSelectRectype()" title="List of available rectypes">
							<option>List of available rectypes</option>
					</select>
					<button onclick="window.showReps.clearAllSeelectionInTree()">Clear marked</button>
					<div  style="padding-right:10px;">
						<button onclick="doEditor(0)">Close Editor</button>
					 button onclick="javascript:setupMCE();">TinyMCE</button
					</div>
-->


		</div>
		</div>


<script type="text/javascript">

var isInited = false;
function setupMCE() {
if(isInited){
   tinyMCE.execCommand('mceToggleEditor',false,'edTemplateBody');
   isEditorVisible = !isEditorVisible;
}else{
   tinyMCE.init({
      mode : "textareas",
      theme : "advanced",
      editor_selector : "mceAdvanced",
/*"advanced"
      plugins : "pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",

      theme_advanced_buttons1 : "bold,italic,underline,strikethrough,forecolor,backcolor,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect,fontselect,fontsizeselect,|,sub,sup,|,charmap,emotions",
      theme_advanced_buttons2 : "cut,copy,paste,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,|,insertdate,inserttime",
      theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,visualaid", //",iespell,media,advhr",
*/
/*
      theme_advanced_buttons1 : "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",
      theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
      theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",
      theme_advanced_buttons4 : "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak",
*/
      theme_advanced_toolbar_location : "top",
      theme_advanced_toolbar_align : "left",
      theme_advanced_statusbar_location : "bottom",
      theme_advanced_resizing : true
   });
   isInited = true;
   isEditorVisible = true;
}

}

	//
	function onPrint()
	{
		try{
			var oIframe = document.getElementById("ifrmPrint");
			var oContent = document.getElementById("rep_container").innerHTML;
			var oDoc = (oIframe.contentWindow || oIframe.contentDocument);
			if (oDoc.document) oDoc = oDoc.document;
			oDoc.write("<head><title></title>");
			oDoc.write("</head><body onload=\"this.focus(); this.print();\">");
			oDoc.write(oContent + "</body>");
			oDoc.close();
		}
		catch(e){
			//self.print();
		}
	}

	//
	function onFile(){

		var sel = document.getElementById('selTemplates');
		if(Hul.isnull(sel) || Hul.isnull(sel.options) || sel.options.length===0) { return; }

		var template_file = sel.options[sel.selectedIndex].value; // by default first entry

		var surl = top.HEURIST.baseURL + "viewers/smarty/showReps.php?"+
				window.showReps.getQuery() + '&debug=0&template='+template_file;

		window.prompt ("Copy to clipboard: Ctrl+C, Enter", surl);

		/*
		try{
			var oIframe = document.getElementById("ifrmPrint");
			var oContent = document.getElementById("rep_container").innerHTML;
			var oDoc = (oIframe.contentWindow || oIframe.contentDocument);
			if (oDoc.document) oDoc = oDoc.document;
			oDoc.write("<head><title></title>");
			oDoc.write("</head><body onload=\"this.focus(); document.execCommand('saveas',false,'c:\export.txt');\">");
			oDoc.write(oContent + "</body>");
			oDoc.close();
		}
		catch(e){
			//self.print();
		}*/
	}

	//
	function onShowEditor()
	{
		var sel = document.getElementById('selTemplates'),
			template_file = sel.options[sel.selectedIndex].value;

		window.showReps.showEditor(template_file);
	}

	//
	function onGenerate()
	{
		var name=jQuery.trim(prompt("Please enter template name",""));
		if (!Hul.isempty(name))
  		{
			window.showReps.generateTemplate(name);
		}
	}

	//
	function doExecute()
	{
		window.showReps.doExecute();
	}

	//
	function doEditor(action)
	{
		window.showReps.operationEditor(action);
	}

	//
	function onSelectTemplate()
	{
		var sel = document.getElementById('selTemplates'),
			template_file = sel.options[sel.selectedIndex].value;

		window.showReps.processTemplate(null, template_file);
	}

	//
	//  starts initialization on load completion of this window
	function loadHandler(){
		window.showReps = new ShowReps();
		//setupMCE();
	}

	YAHOO.util.Event.addListener(window, "load", loadHandler );

</script>

</body>
</html>
