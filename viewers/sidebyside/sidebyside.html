<html>
<head>
<script type="text/javascript">
numberOfSelectedRecords = 0;
var recordID1 = "";
var recordID2 = "";
var db = (top.HEURIST.parameters.db? top.HEURIST.parameters.db :
			(top.HEURIST.database.name?top.HEURIST.database.name:
				(location.search.match(/db=([^&]+)/) ? location.search.match(/db=([^&]+)/)[1]: "")));
var loop = 1;
for(var depth in top.HEURIST.search.selectedRecordIds) {
	IDInRelationIndex = 0;
	while(top.HEURIST.search.selectedRecordIds[depth][IDInRelationIndex]) {
		if(loop == 1) {
			recordID1 = top.HEURIST.search.selectedRecordIds[depth][IDInRelationIndex];
		}
		if(loop == 2) {
			recordID2 = top.HEURIST.search.selectedRecordIds[depth][IDInRelationIndex];
		}
		IDInRelationIndex++;
		numberOfSelectedRecords++;
		loop++;
	}
}
</script>

<link href="../../common/css/global.css" rel="stylesheet" type="text/css">
<link href="../../common/css/search.css" rel="stylesheet" type="text/css">
<link href="../../common/css/side-by-side.css" rel="stylesheet" type="text/css">
</head>
<body>


<div class="wrap">
<div id="errorMsg"></div>
<div id="record1Pane" class="">
	<iframe id="record1Frame" src=""  border="0">
		<p>Your browser does not support iframes.</p>
	</iframe>
</div>
<div id="relationPane" class="">

</div>
<div id="record2Pane" class="" >
	<iframe src="" id="record2Frame" border="0">
		<p>Your browser does not support iframes.</p>
	</iframe>
</div>
</div>
<script type="text/javascript">
if(numberOfSelectedRecords < 2) {
	document.getElementById("errorMsg").innerHTML = "<span>Please select 2 records</span>";
} else if(numberOfSelectedRecords > 2) {
	document.getElementById("errorMsg").innerHTML = "<span>You have selected " + numberOfSelectedRecords + " records. Please select only 2 records</span>";
} else {
	document.getElementById("errorMsg").innerHTML = "";
	document.getElementById("errorMsg").style.display = "none";
	document.getElementById("relationPane").innerHTML = "";
	if(top.HEURIST.search.results.recSet[recordID1].relLinks) {
		for(var relType in top.HEURIST.search.results.recSet[recordID1].relLinks.byRelType) {
			var index = 0;
			while(top.HEURIST.search.results.recSet[recordID1].relLinks.byRelType[relType][index]) {
				var relatedRecordID = top.HEURIST.search.results.recSet[recordID1].relLinks.byRelType[relType][index];
				if(relatedRecordID == recordID2) {
					relTypeName = top.HEURIST.terms.termsByDomainLookup.relation[relType][0];
					document.getElementById("relationPane").innerHTML += "<span><img src='../../common/images/next_page.png'>" + relTypeName + "<img src='../../common/images/next_page.png'></span>";
				}
				index++;
			}
		}
	}
	if(top.HEURIST.search.results.recSet[recordID2].relLinks) {
		for(var relType in top.HEURIST.search.results.recSet[recordID2].relLinks.byRelType) {
			var index = 0;
			while(top.HEURIST.search.results.recSet[recordID2].relLinks.byRelType[relType][index]) {
				var relatedRecordID = top.HEURIST.search.results.recSet[recordID2].relLinks.byRelType[relType][index];
				if(relatedRecordID == recordID1) {
					relTypeName = top.HEURIST.terms.termsByDomainLookup.relation[relType][0];
					document.getElementById("relationPane").innerHTML += "<span><img src='../../common/images/previous_page.png'>" + relTypeName + "<img src='../../common/images/previous_page.png'>";
				}
				index++;
			}
		}
	}
	if(document.getElementById("relationPane").innerHTML == "") {
		document.getElementById("relationPane").innerHTML = "<span>No relations found</span>";
	}
	document.getElementById("errorMsg").innerHTML = "";
	var compare = true;
}

if(compare) {
	var record1Frame = document.getElementById("record1Frame");
	record1Frame.src = top.HEURIST.basePath+"records/view/renderRecordData.php?bib_id="+recordID1+"&db="+db;
	var record2Frame = document.getElementById("record2Frame");
	record2Frame.src = top.HEURIST.basePath+"records/view/renderRecordData.php?bib_id="+recordID2+"&db="+db;
	document.getElementById("record1Pane").setAttribute("class", "recordPane");
	document.getElementById("relationPane").setAttribute("class", "relationPane");
	document.getElementById("record2Pane").setAttribute("class", "recordPane");
} else {
	document.getElementById("record1Pane").setAttribute("class", "hiddenRecordPane");
	document.getElementById("relationPane").setAttribute("class", "hiddenRelationPane");
	document.getElementById("record2Pane").setAttribute("class", "hiddenRecordPane");
}
</script>

</body>
</html>