<?xml version="1.0" encoding="UTF-8"?>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

 <map:components>
  <map:generators default="file"/>
  <map:transformers default="xslt"/>
  <map:serializers default="html"/>
  <map:readers default="resource"/>
  <map:matchers default="wildcard"/>
  <map:selectors default="browser"/>
  <map:pipes default="caching"/>
 </map:components>
 <map:resources>
  <map:resource name="display-xml">
   <map:serialize type="xml"/>
  </map:resource>
  <map:resource name="display-">
   <map:serialize type="html"/>
  </map:resource>
  <map:resource name="display-html">
   <map:serialize type="html"/>
  </map:resource>
  <map:resource name="display-wml">
   <map:serialize type="wml"/>
  </map:resource>
 </map:resources>



 <map:pipelines>
  <!-- main pipeline -->
  <map:pipeline>

	<map:match pattern="^([^/]+)/publish/([^/]+)/(.*)" type="regexp">
		<map:redirect-to uri="cocoon:/{3}?installDir={1}&amp;appDir={2}" />
	</map:match>


    <map:match pattern="*/random_image-js/*">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/random_image-js.xsl">
          <map:parameter name="width" value="{../2}"/>
        </map:transform>
      </map:act>
      <map:serialize type="javascript"/>
    </map:match>

    <map:match pattern="*/*/*-javascript">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/{../2}.xsl">
			<map:parameter name="arg" value="{../3}"/>
			<map:parameter name="id" value="{../1}"/>
			<map:parameter name="appBase" value="/{request-param:installDir}/viewers/publish/{request-param:appDir}/"/>
			<map:parameter name="hBase" value="http://{global:serverName}/{request-param:installDir}/"/>
			<map:parameter name="dbName" value="{request-param:database}"/>
			<map:parameter name="serverBaseUrl" value="http://{global:serverName}"/>
			<map:parameter name="cocoonBase" value="/cocoon/{request-param:installDir}/publish/{request-param:appDir}/"/>
			<map:parameter name="related_rectype_filter" value="{../2}"/>
        </map:transform>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/javascript.xsl"/>
      </map:act>
      <map:serialize type="javascript"/>
    </map:match>

    <map:match pattern="*/*/*.xsl">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/{../3}.xsl">
			<map:parameter name="id" value="{../1}"/>
			<map:parameter name="appBase" value="/{request-param:installDir}/viewers/publish/{request-param:appDir}/"/>
			<map:parameter name="hBase" value="http://{global:serverName}/{request-param:installDir}/"/>
			<map:parameter name="dbName" value="{request-param:database}"/>
			<map:parameter name="serverBaseUrl" value="http://{global:serverName}"/>
			<map:parameter name="cocoonBase" value="/cocoon/{request-param:installDir}/publish/{request-param:appDir}/"/>
			<map:parameter name="related_rectype_filter" value="{../3}"/>
        </map:transform>
        <map:call resource="display-{../2}"/>
      </map:act>
    </map:match>

    <map:match pattern="*/*/*">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/{../2}.xsl">
			<map:parameter name="arg" value="{../3}"/>
			<map:parameter name="id" value="{../1}"/>
			<map:parameter name="appBase" value="/{request-param:installDir}/viewers/publish/{request-param:appDir}/"/>
			<map:parameter name="hBase" value="http://{global:serverName}/{request-param:installDir}/"/>
			<map:parameter name="dbName" value="{request-param:database}"/>
			<map:parameter name="serverBaseUrl" value="http://{global:serverName}"/>
			<map:parameter name="cocoonBase" value="/cocoon/{request-param:installDir}/publish/{request-param:appDir}/"/>
			<map:parameter name="related_rectype_filter" value="{../2}"/>
        </map:transform>
      </map:act>
      <map:serialize/>
    </map:match>

    <map:match pattern="*/random_image-js">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/random_image-js.xsl"/>
      </map:act>
      <map:serialize type="javascript"/>
    </map:match>

    <map:match pattern="*/*.xsl-javascript">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/{../2}.xsl">
			<map:parameter name="id" value="{../1}"/>
			<map:parameter name="appBase" value="/{request-param:installDir}/viewers/publish/{request-param:appDir}/"/>
			<map:parameter name="hBase" value="http://{global:serverName}/{request-param:installDir}/"/>
			<map:parameter name="dbName" value="{request-param:database}"/>
			<map:parameter name="serverBaseUrl" value="http://{global:serverName}"/>
			<map:parameter name="cocoonBase" value="/cocoon/{request-param:installDir}/publish/{request-param:appDir}/"/>
			<map:parameter name="related_rectype_filter" value="{../2}"/>
        </map:transform>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/javascript.xsl"/>
      </map:act>
      <map:serialize type="javascript"><encoding>UTF-8</encoding></map:serialize>
    </map:match>

    <map:match pattern="*/*-javascript">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/{../2}.xsl">
			<map:parameter name="id" value="{../1}"/>
			<map:parameter name="appBase" value="/{request-param:installDir}/viewers/publish/{request-param:appDir}/"/>
			<map:parameter name="hBase" value="http://{global:serverName}/{request-param:installDir}/"/>
			<map:parameter name="dbName" value="{request-param:database}"/>
			<map:parameter name="serverBaseUrl" value="http://{global:serverName}"/>
			<map:parameter name="cocoonBase" value="/cocoon/{request-param:installDir}/publish/{request-param:appDir}/"/>
			<map:parameter name="related_rectype_filter" value="{../2}"/>
        </map:transform>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/javascript.xsl"/>
      </map:act>
      <map:serialize type="javascript"><encoding>UTF-8</encoding></map:serialize>
    </map:match>

    <map:match pattern="*/*.xsl">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;f=1&amp;woot=1;"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/{../2}.xsl">
			<map:parameter name="id" value="{../1}"/>
			<map:parameter name="appBase" value="/{request-param:installDir}/viewers/publish/{request-param:appDir}/"/>
			<map:parameter name="hBase" value="http://{global:serverName}/{request-param:installDir}/"/>
			<map:parameter name="dbName" value="{request-param:database}"/>
			<map:parameter name="serverBaseUrl" value="http://{global:serverName}"/>
			<map:parameter name="cocoonBase" value="/cocoon/{request-param:installDir}/publish/{request-param:appDir}/"/>
			<map:parameter name="related_rectype_filter" value="{../2}"/>
        </map:transform>
      </map:act>
      <map:serialize/>
    </map:match>

    <map:match pattern="*/*">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
        <map:transform src="/{request-param:installDir}/viewers/publish/xsl/{../2}.xsl">
			<map:parameter name="id" value="{../1}"/>
			<map:parameter name="appBase" value="/{request-param:installDir}/viewers/publish/{request-param:appDir}/"/>
			<map:parameter name="hBase" value="http://3{global:serverName}/{request-param:installDir}/"/>
			<map:parameter name="dbName" value="{request-param:database}"/>
			<map:parameter name="serverBaseUrl" value="http://{global:serverName}"/>
			<map:parameter name="cocoonBase" value="/cocoon/{request-param:installDir}/publish/{request-param:appDir}/"/>
			<map:parameter name="related_rectype_filter" value="{../2}"/>
        </map:transform>
      </map:act>
      <map:serialize/>
    </map:match>


    <map:match pattern="*">
      <map:act type="request">
        <map:parameter name="parameters" value="true"/>
        <map:generate src="/{request-param:installDir}/export/xml/hml.php?db={request-param:database}&amp;pub_id={../1}&amp;depth=1&amp;limit=1000&amp;woot=1"/>
      </map:act>
      <map:serialize type="xml"/>
    </map:match>

  </map:pipeline>
 </map:pipelines>
</map:sitemap>
