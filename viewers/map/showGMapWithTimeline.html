<html>
 <head>
  <link rel=stylesheet href="../../common/css/heurist.css">
  <title>Heurist Resource Database - Map and Timeline</title>

  <style>
#all-table { width: 100%; height: 100%; }

#map, #timeline { width: 100%; height: 100%; }
#timeline-cell { height: 200px; }
#info-cell { height: 2em; padding: 0 1ex; }

#timeline-cell * { font-size: 11px; }

#resizer, #resizer div { font-size: 4px; line-height: 4px; overflow: hidden; height: 4px; background-color: white; cursor: n-resize; }

body div { line-height: 1.5em; }

.testLabel {
background-color:RGBA(0,0,0,0.6);
border: 1px solid #FFF;
-moz-border-radius: 6px;
-moz-box-shadow: 0 2px 4px #666;
background-repeat:no-repeat;
font-size:10px;
line-height:10px;
padding:3px 3px 3px 18px;
width:auto;
color:#FFF;
margin-bottom: 20px;
margin-left: -100%;}


  </style>
  <!--<script src="http://simile.mit.edu/timeline/api/timeline-api.js"></script> -->
  <script src="../../external/simile/timeline-api.js" type="text/javascript"></script>

 </head>

 <body onload="load();" style="margin: 0; padding: 0;">

  <table border=0 cellspacing=0 cellpadding=0 id=all-table><tbody>
   <tr><td id=map-cell><div id=map></div></td></tr>
   <tr><td id=resizer><div>&nbsp;</div></td></tr>
   <tr><td id=timeline-cell><div id=timeline></div></td></tr>
   <tr><td id=info-cell>
    <div id=info>
     <label for=filter><input type=checkbox id=filter onclick="timeChange()"> Filter to timebar span</label>
     #Records: <span id=record-count></span> / <span id=total-record-count></span>
    </div>
   </td></tr>
  </tbody></table>

  <script>
  var HEURIST = {};
document.write('<scr'+'ipt src="'+location.pathname.replace(/\/[^\/]*$/,"/")+'tmap-data.php' + location.search + '"></scr'+'ipt>');
</script>


  <script>
if (location.search.match(/\btimeline=0\b/)) {
	var tdTimeline = document.getElementById("timeline-cell");
	tdTimeline.style.display = "none";
	tdTimeline.parentNode.style.display = "none";
	var tdResizer = document.getElementById("resizer");
	tdResizer.style.display = "none";
	tdResizer.parentNode.style.display = "none";
	document.getElementById("info-cell").style.display = "none";
}
</script>


  <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAGZugEZOePOFa_Kc5QZ0UQRQUeYPJPN0iHdI_mpOIQDTyJGt-ARSOyMjfz0UjulQTRjpuNpjk72vQ3w"></script>
  <script src="epoly.js"></script>
  <script src="../../external/js/elabel.js"></script>

  <script src="mapper.js"></script>
  <script src="timeline.js"></script>

  <script>
  function load(){
	if (HEURIST.tmap.totalRecordCount == 0) {
		document.body.style.margin = "10px";
		document.body.innerHTML = "<h3>The search results you are trying to plot do not contain any geographic objects</h3>";
		if (window.stop) window.stop();
		else if (document.execCommand) document.execCommand("Stop");
	}
	else {
		document.getElementById("record-count").innerHTML = "" + HEURIST.tmap.totalRecordCount;
		document.getElementById("total-record-count").innerHTML = "" + HEURIST.tmap.totalRecordCount;
	}
	if (HEURIST.tmap.totalRecordCount > 0) {
		loadMap({ compact: location.search.match(/\bcompact=1\b/) });
		if (! location.search.match(/\btimeline=0\b/)) loadTimeline();
	}

	var resizerCell = document.getElementById("resizer");
	var timelineCell = document.getElementById("timeline-cell");
	resizerCell.onmousedown = function(e) {
		if (! e) e = window.event;

		var downY = e.pageY || e.clientY;
		var downHeight = timelineCell.offsetHeight;

		resizerCell.document_mouseup = function(e) {
			if (! e) e = window.event;

			var upY = e.pageY || e.clientY;
			var upHeight = downHeight + (downY - upY);

			timelineCell.style.height = upHeight + "px";
			timeline.layout();

			if (top.HEURIST.deregisterEvent) {
				top.HEURIST.deregisterEvent(document, "mouseup", resizerCell.document_mouseup);
			}else if (window.removeEventListener) {
				document.removeEventListener("mouseup", resizerCell.document_mouseup,true);
			} else if (window.detachEvent) {
				document.detachEvent("onmouseup", resizerCell.document_mouseup);
			}
		};

		if (top.HEURIST.registerEvent){
			top.HEURIST.registerEvent(document, "mouseup", resizerCell.document_mouseup);
		}else if (window.addEventListener) {
			document.addEventListener("mouseup", resizerCell.document_mouseup,true);
		} else if (window.attachEvent) {
			document.attachEvent("onmouseup", resizerCell.document_mouseup);
		}
	};
}
  </script>

 </body>
</html>
