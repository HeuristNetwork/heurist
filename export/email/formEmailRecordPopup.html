<!--

/**
 * formEmailRecordPopup.html
 *
 * popup form that loads record information (structure) from remote heurist instance and save
 * the record data as email to this remote instance
 *
 * 2011/06/07
 * @author: Artem Osmakov
 *
 * @copyright (C) 2005-2010 University of Sydney Digital Innovation Unit.
 * @link: http://HeuristScholar.org
 * @license http://www.gnu.org/licenses/gpl-3.0.txt
 * @package Heurist academic knowledge management system
 *
 * @todo - load rectype definition from remote heurist instance
 **/

-->
<html>
 <head>
  <title>Email record</title>

  <link rel=stylesheet href="../../common/css/global.css">
 </head>

 <body class="popup" width=600 height=400>
  <script src="../../common/js/utilsLoad.js"></script>
  <script src="../../common/php/displayPreferences.php"></script>
<!--  <script src="../../common/php/loadHAPI.php"></script> -->

<div class="header"><b><span id=rectype-val></span></b><span id=title-val></span></div>
<div id="results"><iframe frameborder=0 class=tab id=edit-frame style="width: 100%; height: 100%;"></iframe></div>
<div id="add_records_footer"><input type=button onClick="window.HEURIST.edit.save();" value="Email record"></div>

  <script>

// object to manage this popup form
window.HEURIST.edit = {
	publicHasChanged: false,

	unchanged: function() {
		window.HEURIST.edit.publicHasChanged = false;
	},

	changed: function() {
		window.HEURIST.edit.publicHasChanged = true;
	},

	save: function() {

		//
		// change attribute of form from saveRecordDetails to emailRecordDetails
		//
		var editFrame = document.getElementById("edit-frame");
		var contentWindow = editFrame.contentWindow;
		if (contentWindow) {
			var form = contentWindow.document.forms[0];

			if(form.setAttribute){
			 	form.setAttribute("jsonAction", top.HEURIST.basePath+'export/email/emailRecordDetails.php');
			}else{
				form.action = top.HEURIST.basePath+'export/email/emailRecordDetails.php';
			}

			if (form.onsubmit  &&  ! form.onsubmit()) {
				return;	// submit failed ... up to the individual form handlers to display messages
			}
			top.HEURIST.registerEvent(editFrame, "load", function() {
				alert('puk puk - email sent');
				window.close();
				//window.close(parent.HEURIST.record.title, parent.HEURIST.record.bdValuesByType, parent.HEURIST.record.bibID);
			});

			(form.heuristSubmit || form.submit)();
			return;
		}
	}
};

	//
	// detect what rectype user has to fill and send by email
	//
	window.HEURIST.parameters = top.HEURIST.parseParams(window.location.search);

	var rectype = parseInt(window.HEURIST.parameters["rectype"]);

	var titleBits = (window.HEURIST.parameters["title"] || "").split(/\s+/);
	var db = (window.HEURIST.parameters["db"] || "");
	for (var i=0; i < titleBits.length; ++i) {
		titleBits[i] = titleBits[i].charAt(0).toUpperCase() + titleBits[i].substring(1);
	}
	var title = titleBits.join(" ");
	document.getElementById("title-val").appendChild(document.createTextNode(title || ""));
	var url = window.HEURIST.parameters["url"];

	var editFrame = document.getElementById("edit-frame");
	editFrame.src = "../../records/edit/tabs/publicInfoTab.html?db="+db+"&rectype="+rectype+"&title="+encodeURIComponent(title);
	editFrame.style.display = "block";

	document.getElementById("rectype-val").appendChild(document.createTextNode(top.HEURIST.rectypes.names[rectype]));


</script>
<!--
<script src="../disambig/similarRecordsPopup.js"></script>
<script>
function popupDisambiguation(matches) {
	_popupDisambiguation(matches, function(choice) {
		if (choice.value == -1) {
			window.HEURIST.record.forceSave = true;
			var editFrame = document.getElementById("edit-frame");
			editFrame.contentWindow.document.forms[0].heuristSubmit();
		}
		else {
			window.close(choice.details.title, [], choice.details.bibID);
		}
	});
}
</script>
-->
 </body>
</html>
