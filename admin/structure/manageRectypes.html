<!--
* manageRectypes.html, Show a list with al rectypes and their values. Show the different recTypeGroups in tabs, and every rectype has an edit button, and an info buttons which shows all it's detailtypes, and an option to edit them, 15-03-2011, by Juan Adriaanse
* @copyright (C) 2005-2010 University of Sydney Digital Innovation Unit.
* @link: http://HeuristScholar.org
* @license http://www.gnu.org/licenses/gpl-3.0.txt
* @package Heurist academic knowledge management system
* @todo Actually delete a rectype from database when delete button is pressed
* @todo When unchecking/checking the 'active' checkbox, write the change to database
-->

<html>
<head>

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Heurist - Manage recordtypes</title>

<link rel="icon" href="../../favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon">

<link rel="stylesheet" type="text/css" href="../../common/css/global.css">

<!-- YUI -->
<link rel="stylesheet" type="text/css" href="../../external/yui/2.8.2r1/build/fonts/fonts-min.css" />
<link rel="stylesheet" type="text/css" href="../../external/yui/2.8.2r1/build/tabview/assets/skins/sam/tabview.css" />
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/yahoo-dom-event/yahoo-dom-event.js"></script>
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/element/element-min.js"></script>
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/tabview/tabview-min.js"></script>
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/history/history-min.js"></script>
		<script type="text/javascript" src="../../external/yui/2.8.2r1/build/json/json-min.js"></script>

<!-- DATATABLE DEFS -->
<link type="text/css" rel="stylesheet" href="../../external/yui/2.8.2r1/build/datatable/assets/skins/sam/datatable.css">
<!-- datatable Dependencies -->
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/datasource/datasource-min.js"></script>
<!-- OPTIONAL: Drag Drop (enables resizeable or reorderable columns) -->
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/dragdrop/dragdrop-min.js"></script>
<!-- Source files -->
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/datatable/datatable-min.js"></script>
<!-- END DATATABLE DEFS-->

<!-- PAGINATOR -->
<link rel="stylesheet" type="text/css" href="../../external/yui/2.8.2r1/build/paginator/assets/skins/sam/paginator.css">
<script type="text/javascript" src="../../external/yui/2.8.2r1/build/paginator/paginator-min.js"></script>
<!-- END PAGINATOR -->

<script type="text/javascript" src="../../external/jquery/jquery.js"></script>

<!-- MULTISELECTION DROPDOWN -->
<script language="javascript" type="text/javascript" src="../../external/js/arc90_multiselect.js"></script>
<script language="javascript" type="text/javascript" src="../../external/js/arc90_multiselect.css"></script>
<script language="javascript" type="text/javascript">
			// change the default options for all multiselects
			a$.NO_SELECTION	= 'No selection';		// TEXT for 'No selection' when nothing selected
			a$.SELECTED		= 'Options selected';	// TEXT for 'XX Options selected' when over 1 selected
			a$.SELECT_ALL	= 'Select All';			// TEXT for 'Select All' for checkboxes
			a$.SelectAllMin	= 6;					// minimum number of options needed to show 'Select All'
			a$.WhenToUse	= 'class';				// class | multiple | all : for how to make selects become multiselects
			a$.msSeparator	= ',';					// separator for values (can be multiple characters)
</script>

<style type="text/css">
.tooltip {
	position:absolute;
	z-index:999;
	left:-9999px;
	top:0px;
	background-color:#dedede;
	padding:5px;
	border:1px solid #fff;
	min-width:200;
}
.newGroupRow {
	display: block;
}
.newGroupLabel {
	display: inline-block;
	width: 60px;
	text-align: right;
	padding-right: 3px;
}
.newGroupValue {
	display: inline-block;
}
.newGroupButton {
	padding-left: 63px;
	padding-bottom: 20px;
}
#yui-history-iframe {
	position:absolute;
	top:0; left:0;
	width:1px; height:1px; /* avoid scrollbars */
	visibility:hidden;
}

#modelTabs {
    z-index:0;
}

.yui-dt-dropdown {width:90px; border-style: none;}

.yui-dt table {
				width: 680px;
}

</style>

</head>

<body class="yui-skin-sam" style="overflow: auto;">

<script src="../../common/js/utilsLoad.js"></script>
<script src="../../common/php/displayPreferences.php"></script>
<script src="../../common/php/loadCommonInfo.php"></script>

<div class="tooltip" id="toolTip2"><p>popup popup</p></div>

<div style="width:690;margin:auto;">

	<div>
		<h2 id="header2" style="display: inline-block;">Record Types</h2>
		<div style="float: right; padding-top: 15px"><label id="lblNoticeAboutChanges" style="display: inline-block;"></label>&nbsp;&nbsp;&nbsp;<input id="btnSave" type="button" value="Save Changes" style="float: right; display: none;"/></div>
	</div>

<!--  style="position:absolute; z-index:0;"
	 Static markup required by the browser history utility. Note that the
	 iframe is only used on Internet Explorer. If this page is server
	 generated (by a PHP script for example), it is a good idea to create
	 the IFrame ONLY for Internet Explorer (use server side user agent sniffing) -->

<input id="yui-history-field" type="hidden">

<div id="modelTabs" class="yui-navset yui-navset-top">

<script	 type="text/javascript">
var filterval;
var currentTabIndex;
var currentTab;
var hideTimer;

YAHOO.util.Event.addListener(window, "load", function() {
	//keep table and source - to avoid repeat load and for filtering
	var arrTables = [];
	var arrDataSources = [];

	var currentTipId;
	var needHideTip = true;

	var _groups = [],  //for dropdown list
		_deleted = []; //keep removed types to exclude on filtering

	//object to send changes (visibility and group belong) for update on server
	var _oRecordType = {rectype:{
		colNames:{common:['rty_ShowInLists','rty_RecTypeGroupIDs']},
		defs: {}
	}};

	var _lblNotice, //label that notify that some thing was changed - visibility of group
		_btnSave,   //button to send changes to server side
		_updatesCnt = 0;

	var tabView = new YAHOO.widget.TabView();
	var ind = 0;

	// init tabview with names of group
	for (var grpID in top.HEURIST.rectypes.groups) {

		var grpName = top.HEURIST.rectypes.groups[grpID].name;

		_groups.push({value:grpID, text:grpName});

		tabView.addTab(new YAHOO.widget.Tab({
			id: grpID,
			label: grpName,
			content:
			('<div>'+                   //for="filter"
			'<div style="display:inline-block;"><label>Filter by name:</label>'+
			'<input type="text" id="filter'+ind+'" value="">'+
			'&nbsp;&nbsp;<input type="checkbox" id="filter'+ind+'vis" value="1" style="padding-top:5px;">&nbsp;Show active only</div>'+
			'<div style="float:right; text-align:right">'+
			'<input type="button" id="createNewRectype'+ind+'" onClick=\"editRectypeWindow()\" value="Add Record Type"/>'+
			'<input type="button" id="createNewDetailType'+ind+'" onClick=\"editDetailTypeWindow()\" value="Add Field Type"/>'+
			'</div></div>'+
			'<div id="tabContainer'+grpID+'"></div></div>')

			}));

		arrTables.push(null);
		arrDataSources.push(null);
		ind++;
	}
	tabView.addTab(new YAHOO.widget.Tab({
		id: "newTab",
		label: "+",
		content:
		('<h3>Create a new rectype group:</h3><br />'+

		'<div class="newGroupRow">'+
			'<label class="newGroupLabel">Name: </label>'+
			'<input class="newGroupValue" id="rtg_Name" maxlength="40" />'+
		'</div><br />'+

		'<div class="newGroupRow">'+
			'<label class="newGroupLabel">Description: </label>'+
			'<input class="newGroupValue" id="rtg_Description" maxlength="250" />'+
		'</div><br />'+

		'<input class="newGroupButton" type="button" onclick="createNewModel()" value="Create" />'+
		'')
	}));
	tabView.appendTo("modelTabs");

	//
	// on changing of tab - create and fill datatable for particular group
	//
	function handleTabChange (e) {

		if(e.newValue.get("id")!="newGroup" && e.newValue!=e.prevValue)
		{
			initTabContent(e.newValue);
			var tabFilter = YAHOO.util.Dom.get('filter'+currentTabIndex);
			if(tabFilter) {
				if(filterval) {
					tabFilter.value = filterval;
				}
				else {
					tabFilter.value = "";
				}
			}
			clearTimeout(filterTimeout);
			setTimeout(updateFilter,600);
		}
	}

	//
	//add listener for tabview
	//
	function initTabView () {
		tabView.addListener("activeTabChange", handleTabChange);

		//init the content for the first tab (table and buttons)
		tabView.set("activeIndex", 0);
	}

	//
	// create the content of tab: buttons and datatable
	function initTabContent(tab) {

		var grpID = tab.get('id');

		//does not work var dt = YAHOO.util.Dom.get("datatable"+grpID);

		currentTabIndex = tabView.get('activeIndex');
		currentTab = tabView.get('activeTab').get('id');

		var dt = arrTables[currentTabIndex];

		if(dt==undefined || dt==null) {

			var arr = [];
			//create datatable and fill it values of particular group
			for (var rectypeID in top.HEURIST.rectypes.typedefs) {
				if(rectypeID != "commomFieldNames" && rectypeID != "dtFieldNames") {
					var td = top.HEURIST.rectypes.typedefs[rectypeID];
					var rectype = td.commonFields;
					if(rectype[9].indexOf(grpID)>-1) {
						arr.push([rectypeID, rectype[7],
						"<img src=\"../../common/images/rectype-icons/"+rectypeID+".gif\">",
						rectype[0], rectype[1], rectype[8], rectype[9]]);

						/*TODO: top.HEURIST.detailTypes.rectypeUsage[rectypeID].length*/
					}
				}
			}

			var myDataSource = new YAHOO.util.LocalDataSource(arr,{
				responseType : YAHOO.util.DataSource.TYPE_JSARRAY,
				responseSchema : {
					fields: [ "id", "active", "icon", "name", "description", "status", "grp_ids"]
					},
					doBeforeCallback : function (req,raw,res,cb) {
					// This is the filter function
						var data  = res.results || [],
						filtered = [],
						i,l;

						if (req) {

							var fvals = req.split("|");

							var sByName   = fvals[0].toLowerCase();
							var iByVisibility = fvals[1];

							// when we change the table, the datasource is not changed
							// thus we need an additional filter to filter out the deleted rows
							// and rows that were moved to another groups
							var currentTabIndex = tabView.get('activeIndex');
							var grpID = tabView.getTab(currentTabIndex).get('id');

							for (i = 0, l = data.length; i < l; ++i) {

								// when we change the table, the datasource is not changed
								//thus we need to update visibility manually
								var rec_ID = data[i].id;
								var df = _oRecordType.rectype.defs[rec_ID];
								if(df!=undefined){
									data[i].active  = df.common[0];
									data[i].grp_ids = df.common[1];
								}

								if ((data[i].name.toLowerCase().indexOf(sByName)>-1)
									&& (data[i].grp_ids.indexOf(grpID)>-1)
									&& (_deleted.indexOf(rec_ID)<0)
									&& (iByVisibility==0 || data[i].active==iByVisibility))
								{
									filtered.push(data[i]);
								}
							}//for

							res.results = filtered;
						}

						return res;
					}
			});

			var myColumnDefs = [
				{ key: "id", label: "<u>Code</u>", sortable:true, width:20, className:'left' },
				{ key: "active", label: "Active", sortable:false, width:20, formatter:YAHOO.widget.DataTable.formatCheckbox, className:'center' },
				{ key: null, label: "Edit", sortable:false, width:20, formatter: function(elLiner, oRecord, oColumn, oData) {
					elLiner.innerHTML = '<a href="#edit"><img src="../../common/images/edit_icon.png" width="16" height="16" border="0" title="Edit" /><\/a>'}
				},
				{ key: null, label: "Info", sortable:false, width:20, formatter: function(elLiner, oRecord, oColumn, oData) {
					elLiner.innerHTML = '<a href="#info"><img src="../../common/images/info_icon.png" width="16" height="16" border="0" title="Info" /><\/a>'}
				},
				{ key: "usage", label: "Usage", hidden:true },
				{ key: "grp_ids", label: "Group", sortable:false, width:90,
					formatter:YAHOO.widget.DataTable.formatDropdown, dropdownOptions:_groups},
				{ key: "icon", label: "Icon", sortable:false },
				{ key: "name", label: "<u>Name</u>", sortable:true },
				{ key: "description", label: "Description", sortable:false},
				{ key: "status", label: "<u>Status</u>", sortable:true },
				{ key: null, label: "Del", width:20, sortable:false, formatter: function(elLiner, oRecord, oColumn, oData) {
					elLiner.innerHTML = '<a href="#delete"><img src="../../common/images/delete_icon.png" width="16" height="16" border="0" title="Delete" /><\/a>'}
				},

			];

			var myConfigs = {
				//selectionMode: "singlecell",
				paginator : new YAHOO.widget.Paginator({
					rowsPerPage: 100,
					totalRecords: arr.length,

					// use a custom layout for pagination controls
					template: "Page: {PageLinks} &nbsp Show {RowsPerPageDropdown} per page",

					// show all links
					pageLinks: YAHOO.widget.Paginator.VALUE_UNLIMITED,

					// use these in the rows-per-page dropdown
					rowsPerPageOptions: [25, 50, 100]

				})
			};

			dt = new YAHOO.widget.DataTable('tabContainer'+grpID, myColumnDefs, myDataSource, myConfigs);

			//click on action images
			dt.subscribe('linkClickEvent', function(oArgs){
				YAHOO.util.Event.stopEvent(oArgs.event);

				var elLink = oArgs.target;
				var oRecord = this.getRecord(elLink);
				var rectypeID = oRecord.getData("id");

				if(elLink.hash == "#edit") {
					editRectypeWindow(rectypeID);
				}
				if(elLink.hash == "#delete") {
					// TODO: Check if contains existing records
					var value = prompt("Enter \"DELETE\" if you really want to delete rectype '"+oRecord.getData('name')+"'");
					if(value == "DELETE") {
						var deleteResult = deleteRectype(rectypeID);
						if(deleteResult) {
							dt.deleteRow(oRecord.getId(), -1);
							_deleted.push( rectypeID );
							alert("Record type deleted");
						} else {
							alert("Deletion failed");
						}
					}
					else {
					}
				}
			});

			dt.subscribe('dropdownChangeEvent', function(oArgs){
				    var elDropdown = oArgs.target;
				    var record = this.getRecord(elDropdown);
					var column = this.getColumn(elDropdown);
					var newValue = elDropdown.options[elDropdown.selectedIndex].value;
					var oldValue = record.getData(column.key);
					var recordIndex = this.getRecordIndex(record);
					var recordKey = record.getData('recordKey');
					if(newValue!=oldValue){
						//this.deleteRow(recordIndex);
						var data = record.getData();
						data['grp_id'] = newValue;

						var newTabIndex = elDropdown.selectedIndex; //getTabIndexByGroup(newValue);
						var ndt = arrTables[newTabIndex];
						if(ndt!=null){
							// need to refill the destionation table,
							// otherwise datasource is not updated
							arrTables[newTabIndex] = null; //.addRow(record.getData(), 0);
						}

						//remove from this table and refresh another one
						window.setTimeout(function() {
										dt.deleteRow(record.getId(), -1);
										}, 100);

						//keep the track of changes in special object
						_updateRecordType(record);
					}
			});

			//subscribe on checkbox event (visibility)
			dt.subscribe("checkboxClickEvent", function(oArgs) {
						var elCheckbox = oArgs.target;
						var oRecord = dt.getRecord(elCheckbox);
						var data = oRecord.getData();
						data['active'] = elCheckbox.checked?1:0;

						//var recindex = dt.getRecordIndex(oRecord);
						//dt.updateRow(recindex, data);

						//keep the track of changes in special array
						_updateRecordType(oRecord);
			});

	//
	// keep the changes in object that will be send to server
	//
	function _updateRecordType(oRecord)
	{
			var rty_ID = oRecord.getData('id');
			var newvals = [oRecord.getData('active'), oRecord.getData('grp_ids')];

			//update HEURIST
			var td = top.HEURIST.rectypes.typedefs[rty_ID];
			var deftype = td.commonFields;
			deftype[7] = newvals[0]; //visibility
			deftype[9] = newvals[1]; //group

			//update keep object
			var dt_def = _oRecordType.rectype.defs[rty_ID];
			if(dt_def==undefined){
				 	_oRecordType.rectype.defs[rty_ID] = {common:newvals};
				 	_updatesCnt++;
			}else{
					_oRecordType.rectype.defs[rty_ID].common = newvals;
			}

			if(_lblNotice==null){
				_lblNotice = YAHOO.util.Dom.get("lblNoticeAboutChanges");
				_btnSave   = YAHOO.util.Dom.get("btnSave");
				_btnSave.onclick = _updateRecordTypeOnServer
			}

			_lblNotice.innerHTML = 'You have changed <b>'+_updatesCnt+'</b> field type'+((_updatesCnt>1)?'s':'');
			_btnSave.style.display = 'block';
	}
	//
	// send updates to server
	//
	function _updateRecordTypeOnServer(event) {
		var str = YAHOO.lang.JSON.stringify(_oRecordType);
		alert("Stringified changes: " + str);

		if(str != null) {
			_updateResult(""); //debug
			return;//debug

			// TODO: Change base URL
			var baseurl = top.HEURIST.baseURL + "admin/structure/saveStructure.php";
			var callback = _updateResult;
			var params = "method=saveRT&";
			params += "data=" + str;
			top.HEURIST.util.getJsonData(baseurl, callback, params);
		}
	}
	//
	//
	//
	function _updateResult(context) {
		_updatesCnt = 0;
		_oRecordType.rectype.defs = {}; //clear keeptrack
		_btnSave.style.display = 'none';
		_lblNotice.innerHTML = '';
	}

			//mouse over help colums shows the detailed description
			dt.on('cellMouseoverEvent', function (oArgs) {
				clearHideTimer();

				var forceHideTip = true;
				var textTip = null;
				var target = oArgs.target;
				var column = this.getColumn(target);

				if(column!=null && column.key == 'info') {
					var record = this.getRecord(target);
					var rectypeID = record.getData('id');

					if(currentTipId != rectypeID) {
						currentTipId = rectypeID;
						var xy = [parseInt(oArgs.event.pageX,10) + 10, parseInt(oArgs.event.pageY,10) - 20 ];

						//find all records that reference this type
						var details = top.HEURIST.rectypes.typedefs[rectypeID].dtFields;
						var textTip = "<strong>Fields:</strong> &nbsp&nbsp <label style=\"color: #4499ff;\">Click on field type to edit</label><br /><p><ul>";

						for(var detail in details) {
							textTip = textTip + "<li><a href='javascript:void(0)' onClick=\"editDetailTypeWindow("+detail+")\">" + details[detail][0] + "</a></li>";
						}
						textTip = textTip + "</ul></p>";
					} else {
						forceHideTip = false;
					}
				}
				if(textTip!=null) {
					needHideTip = true;
					var my_tooltip = $("#toolTip2");

					my_tooltip.mouseover(clearHideTimer2);
					my_tooltip.mouseout(hideToolTip2);

										var border_top = $(window).scrollTop();
										var border_right = $(window).width();
										var border_height = $(window).height();
										var left_pos;
										var top_pos;
										var offset = 15;
										if(border_right - (offset *2) >= my_tooltip.width() +  xy[0]) {
											left_pos = xy[0]+offset;
										} else {
											left_pos = border_right-my_tooltip.width()-offset;
										}

										if((border_top + offset *2) >=  xy[1] - my_tooltip.height()) {
											top_pos = border_top + offset + xy[1]; //
										} else {
											top_pos = border_top + xy[1] - my_tooltip.height()-offset;
										}
										if(top_pos + my_tooltip.height() > border_top+border_height){
											top_pos	= border_top + border_height - my_tooltip.height()-5;
										}


										//var lft = my_tooltip.css('left');
										my_tooltip.css( {
											left:left_pos+'px', top:top_pos+'px'
										});

					my_tooltip.html(textTip);
					hideTimer = window.setTimeout(hideToolTip, 5000);
				}
				else if(forceHideTip) {
					hideToolTip();
				}
			});

			dt.on('cellMouseoutEvent', function (oArgs) {
				hideTimer = window.setTimeout(hideToolTip, 2000);
			});

			function hideToolTip2() {
				needHideTip = true;
			}

			function clearHideTimer2() {
				needHideTip = false;
				clearHideTimer();
			}

			function hideToolTip() {
				if(needHideTip){
					currentTipId = null;
					clearHideTimer();
					var my_tooltip = $("#toolTip2");
					my_tooltip.css( {
						left:"-9999px"
					});
				}
			}

			function clearHideTimer() {
				if (hideTimer) {
					window.clearTimeout(hideTimer);
					hideTimer = 0;
				}
			}

			arrTables[currentTabIndex] = dt;
			arrDataSources[currentTabIndex] = myDataSource;

			var filter = YAHOO.util.Dom.get('filter'+currentTabIndex);
			filter.onkeyup = function (e) {
				clearTimeout(filterTimeout);
				setTimeout(updateFilter,600);  };

			var filtervis = YAHOO.util.Dom.get('filter'+currentTabIndex+'vis');
			filtervis.onchange = function (e) {
				clearTimeout(filterTimeout);
				updateFilter();  };

		}
	}

	//
	// filtering by name
	// listenter is activated along with dataTable creation
	//
	var filterTimeout = null;
	var updateFilter  = function () {
			// Reset timeout
			filterTimeout = null;

			var currentTabIndex = tabView.get('activeIndex');
			var dtable = arrTables[currentTabIndex];
			var dsource = arrDataSources[currentTabIndex];

			// Reset sort
			var state = dtable.getState();
			state.sortedBy = {key:'name', dir:YAHOO.widget.DataTable.CLASS_ASC};

			var filterval = YAHOO.util.Dom.get('filter'+currentTabIndex).value;
			var filtervis = YAHOO.util.Dom.get('filter'+currentTabIndex+'vis').checked?1:0;

			// Get filtered data
			dsource.sendRequest(filterval+'|'+filtervis, {
				success : dtable.onDataReturnInitializeTable,
				failure : dtable.onDataReturnInitializeTable,
				scope	  : dtable,
				argument : { pagination: { recordOffset: 0 } } // to jump to page 1
			});
	};


	(function () {

		var bookmarkedTabViewState = YAHOO.util.History.getBookmarkedState("tabview");
		var initialTabViewState = bookmarkedTabViewState || "tab0";

		YAHOO.util.History.register("tabview", initialTabViewState, function (state) {
			tabView.set("activeIndex", state.substr(3));	//restre the index from history
		});

		YAHOO.util.History.onReady(function () {
			var currentState;

			initTabView();

			currentState = YAHOO.util.History.getCurrentState("tabview");

			if(currentState && currentState.length>3) {
				  tabView.set("activeIndex", currentState.substr(3));  //restore active tab from history
			}
		});

		try {
			YAHOO.util.History.initialize("yui-history-field", "yui-history-iframe");
		} catch (e) {
			initTabView();
		}

	})();

});

function deleteRectype(ID) {
	if(ID != null) {
		// TODO: Call does not work
		var baseurl = top.HEURIST.baseURL + "admin/structure/saveStructure.php";
		var callback = deletionResult;
		var params = "method=deleteRT&";
		params += "rtyID=" + ID;
		top.HEURIST.util.getJsonData(baseurl, deletionResult, params);
	}
}

var deletionResult = function(context) {
	alert("Deletion result: " + context);
	if(context) {
		return true;
	} else {
		return false;
	}
}

function editRectypeWindow(ID) {
	var URL = "";
	if(ID) {
		URL = top.HEURIST.basePath + "admin/structure/editRectype.html?rectypeID=" + ID;
	} else {

		URL = top.HEURIST.basePath + "admin/structure/editRectype.html?groupID=" + currentTab;
	}
	top.HEURIST.util.popupURL(top, URL, {
		"close-on-blur": false,
		"no-resize": true,
		height: 620,
		width: 660,
		callback: function(changedValues) {
			if(changedValues == null) {
				// Canceled
			} else {
				// TODO: reload datatable
			}
		}
	});
}

function editDetailTypeWindow(detailTypeID) {
	var URL = "";
	if(detailTypeID) {
		URL = top.HEURIST.basePath + "admin/structure/editDetailType.html?detailTypeID="+detailTypeID;
	}
	else {
		URL = top.HEURIST.basePath + "admin/structure/editDetailType.html";
	}
	top.HEURIST.util.popupURL(top, URL, {
		"close-on-blur": false,
		"no-resize": true,
		height: 560,
		width: 650,
		callback: function(changedValues) {
			if(changedValues == null) {
				// Canceled
			} else {
				// TODO: reload datatable
			}
		}
	});
}

function createNewModel() {
	alert('Create new model: ' + document.getElementById("rtg_Name").value + ' with description: ' + document.getElementById("rtg_Description").value);
}

</script>
</div>
</div>
</body>
</html>