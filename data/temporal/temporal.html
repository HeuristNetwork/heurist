<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Temporal Object</title>
		<style type="text/css">
			/*margin and padding on body element
			  can introduce errors in determining
			  element position and are not recommended;
			  we turn them off as a foundation for YUI
			  CSS treatments. */
			body {
				margin:0;
				padding:0;
			}
			.date-button {
				margin: 3px;
				width: 24px;
				height: 18px;
				background: url(../../common/images/cal.gif) lightgray scroll center center no-repeat;
			}
		</style>

		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.0r4/build/fonts/fonts-min.css" />
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.0r4/build/tabview/assets/skins/sam/tabview.css" />
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.0r4/build/calendar/assets/skins/sam/calendar.css" />

		<script type="text/javascript" src="http://yui.yahooapis.com/2.8.0r4/build/yahoo-dom-event/yahoo-dom-event.js"></script>

		<script type="text/javascript" src="http://yui.yahooapis.com/2.8.0r4/build/element/element-min.js"></script>
		<script type="text/javascript" src="http://yui.yahooapis.com/2.8.0r4/build/tabview/tabview-min.js"></script>
		<script type="text/javascript" src="http://yui.yahooapis.com/2.8.0r4/build/calendar/calendar-min.js"></script>

		<!--link rel="stylesheet" type="text/css" href="../../yui/2.7.0/build/fonts/fonts-min.css" />
		<link rel="stylesheet" type="text/css" href="../../yui/2.7.0/build/tabview/assets/skins/sam/tabview.css" />
		<link rel="stylesheet" type="text/css" href="../../yui/2.7.0/build/calendar/assets/skins/sam/calendar.css" />

		<script type="text/javascript" src="../../yui/2.7.0/build/yahoo-dom-event/yahoo-dom-event.js"></script>

		<script type="text/javascript" src="../../yui/2.7.0/build/element/element-min.js"></script>
		<script type="text/javascript" src="../../yui/2.7.0/build/tabview/tabview-min.js"></script>
		<script type="text/javascript" src="../../yui/2.7.0/build/calendar/calendar-min.js"></script-->

		<!--link rel="stylesheet" type="text/css" href="../../yui/build/fonts/fonts-min.css" />
		<link rel="stylesheet" type="text/css" href="../../yui/build/tabview/assets/skins/sam/tabview.css" />
		<link rel="stylesheet" type="text/css" href="../../yui/build/calendar/assets/skins/sam/calendar.css" />

		<script type="text/javascript" src="../../yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
grrr
		<script type="text/javascript" src="../../yui/build/element/element-min.js"></script>
		<script type="text/javascript" src="../../yui/build/tabview/tabview-min.js"></script>
		<script type="text/javascript" src="../../yui/build/calendar/calendar-min.js"></script>

		<script>
			Timeline_ajax_url="../../external/timeline/timeline_ajax/simile-ajax-api.js?bundle=false";
			Timeline_urlPrefix='../../external/timeline/timeline_js/';
			Timeline_parameters='bundle=false';
		</script>
		<script src="../../external/timeline/timeline_js/timeline-api.js" type="text/javascript"></script-->

	</head>
	<body class=" yui-skin-sam" style="background-color:rgb(240,240,240);" width=400 height=400 >

		<div id=display-div class="yui-navset">
			<ul class="yui-nav">
				<li><a href="#s"><em>Simple Date</em></a></li>
				<li class="selected"><a href="#p"><em>Date Range</em></a></li>
				<li><a href="#f"><em>Aproximate Date</em></a></li>
				<li><a href="#c"><em>C14 Date</em></a></li>

			</ul>
			<div class="yui-content" style="background-color:rgb(240,240,240); border:0;">
				<div id="s">
					<div style="margin: 20px  0px 0px 50px">
						<div>
							<span title="Enter date in  y-m-d">
							Date:&nbsp;<input type=text id="simpleDate" style="width:150px;" />
							<input type=button class="date-button" id="calendar" onclick="calendarPopup(this);" />
							</span>
						</div>
						<div style="margin:5px 0px 15px 35px; font-size:8pt; color:grey;"  >
							<span >Year(eg.1624) of calendar date (yyyy-mm or yyyy-mm-dd)</span><br/>
							<span >use minus(-) for BCE dates(eg. -375 for 375 BCE)</span>
						</div>
					</div>
					<div style="border-top:1px solid lightgrey; margin :0px 10px"></div>
					<div style="margin: 15px  0px 0px 50px">
						<div>
							<span title="Enter time in  h:m:s">
								Time:&nbsp;<input type=text id="simpleTime" style="width:80px;" />
								<span style="font-size:8pt; color:grey;">&nbsp;(optional)</span>
							</span>
							<span title="Enter Time Zone offset starting with hours only enter minute for non-zero" style="margin:0px 30px">
								Time Zone:&nbsp;<u>+</u>
								<input type=text id="tzone" title="Time Zone Adjust hours (-12 to +12)" style="width:60px;" />
								<span style="font-size:8pt; color:grey;">&nbsp;(optional)</span>
							</span>
						</div>
						<div style="margin:5px 0px 15px 35px; font-size:8pt; color:grey;"  >
							<span>hh or hh:mm or hh:mm:ss</span>
							<span style="margin: 0px 120px;">+ for east (Europe,Africa,Asia)</span><br/>
							<span style="margin: 0px 0px 0px 245px;">- for west (N &amp; S America)</span>
						</div>
					</div>
				</div>
				<div id="p">
					<div style="margin:20px 0px 10px 60px;">
						<canvas id="dRangeCanvas" width="530" height="80">
						</canvas>
					</div>
					<div style="margin-left:30px;">
						<div>
							<span title="Enter only the known values starting with year" style=" margin:0px 5px;">
								<input type=text id="TPQ" style="width:100px;" />
							</span>
							<span title="Press to set Probable begin equal to TPQ" style=" margin:0px 5px;">
								<input type=button id="setPDB" value="set =>" onclick="setPDBtoTPQ();" style="font-size: 7pt; width:35px;" />
							</span>
							<span title="Enter only the known values starting with year" style=" margin:0px 5px;">
								<input type=text id="PDB" style="width:100px;" />
							</span>
							<img style="width:30px; height:1px; border-top: 2px solid grey; margin:0px 5px;"/>
							<span title="Enter only the known values starting with year" style=" margin:0px 5px;">
								<input type=text id="PDE" style="width:100px;" />
							</span>
							<span title="Press to set Probable end equal to TAQ" style=" margin:0px 5px;">
								<input type=button id="setPDE" value="<= set" onclick="setPDEtoTAQ();" style="font-size: 7pt; width:35px;" />
							</span>
							<span title="Enter only the known values starting with year" style=" margin:0px 5px;">
								<input type=text id="TAQ" style="width:100px;" />
							</span>
						</div>
						<div>
							<span style="margin:5px 0px 15px 5px; font-size:8pt; color:grey;"> Terminus Post Quem </span>
							<span style="margin:5px 0px 15px 75px; font-size:8pt; color:grey;"> Probable begin </span>
							<span style="margin:5px 0px 15px 95px; font-size:8pt; color:grey;"> Probable End </span>
							<span style="margin:5px 0px 15px 72px; font-size:8pt; color:grey;"> Terminus Ante Quem </span>
						</div>
					</div>
					<div style="margin:20px 0px 20px 80px;">
						<span id="pSProfDiv">
							<label for="SPF" title="Select the profile">Start Profile:</label>
							<select id="SPF">
								<option label="Flat"  selected value=0>Flat</option>
								<option label="Bezier" value=1>Bezier</option>
								<option label="Slow Start" value=2>Slow Start</option>
								<option label="Slow Finish" value=3>Slow Finish</option>
							</select>
						</span>
						<img style="height:1px; margin:0px 70px;"/>
						<span id="pEProfDiv">
							<label for="EPF" title="Select the profile">End Profile:</label>
							<select id="EPF">
								<option label="Flat"  selected value=0>Flat</option>
								<option label="Bezier" value=1>Bezier</option>
								<option label="Slow Start" value=2>Slow Start</option>
								<option label="Slow Finish" value=3>Slow Finish</option>
							</select>
						</span>
					</div>
					<div style="margin:10px 20px; ">
						<div style="border: 1px solid grey; float:left; width:300px; padding:10px;" >
							<b>Entering dates</b><br/>
							<span style="font-size:8pt; color:grey;">Year(eg.1624) of calendar date (yyyy-mm or yyyy-mm-dd)<br/>
							use minus(-) for BCE dates(eg. -375 for 375 BCE)</span><br/><br/>
							<b>Start &amp; End profile</b><br/>
							<span style="font-size:8pt; color:grey;">What is the distribution of the likelihood of the date<br/>
							between the terminus date and the probable date<br/>
							(if in doubt, choose flat, that is any point is equally likely).</span><br/>
						</div>
						<div id="deterDiv" style="float:left;margin:0px 0px 0px 57px;">
							Type of Determination<br/>
							<span style="font-size:8pt; color:grey;">
							How where the dates arrived at?
							</span>
							<div style="margin:10px 25px;">
								<input type="radio" name="pDET"  value="0" checked="checked" />Unknown<br/>
								<input type="radio" name="pDET" value="1"/>Attested<br/>
								<input type="radio" name="pDET"  value="2"/>Conjecture<br/>
								<input type="radio" name="pDET"  value="3"/>Measurement
							</div>
						</div>

					</div>
				</div>
				<div id="f">
					<div style="margin:20px 0px 20px 50px; ">
						<div style="float:left; width:430px;">
							<div>
								<span title="Enter date in  y-m-d">
								Approximate date&nbsp;<input type=text id="fDAT" style="width:150px;" />
								</span>
							</div>
							<div style="font-size:8pt; color:grey; margin:5px 0px 15px 105px;">
								<span >Year(eg.1624) of calendar date (yyyy-mm or yyyy-mm-dd)</span><br/>
								<span >use minus(-) for BCE dates(eg. -375 for 375 BCE)</span>
							</div>
							<div>
								<div title="Enter duration in  PnYnMnDTnHnMnS format">
									<span style="margin-right:50px">Range</span>
									<u>+</u>&nbsp;&nbsp;<input type=text id="fRNG" style="width:50px; margin-right:5px" />
                                    <select id="level">
										<option label="Year"  selected value="Y">Year</option>
										<option label="Month" value="M">Month</option>
										<option label="Day" value="D">Day</option>
									</select><br/>
								</div>
	                            <div style="font-size:8pt; color:grey; margin: 5px 0px 15px 105px;">
									Actual date is assumed to lie withinthis range.
								</div>
							</div>
							<div id="fProfDiv" >
								<label for="fPRF" title="Select the profile">Probability curve &nbsp;</label>
								<select id="fPRF">
									<option label="Flat"  selected value=0>Flat</option>
									<option label="Bezier" value=1>Bezier</option>
									<option label="Slow Start" value=2>Slow Start</option>
									<option label="Slow Finish" value=3>Slow Finish</option>
								</select><br/>
	                            <div style="font-size:8pt; color:grey; margin: 5px 0px 0px 105px;">
									Distribution of the likelihood of the date between the limits set by the range.
								</div>
							</div>
						</div>
						<div id="fdeterDiv" style="float:left;margin:0px 0px 0px 57px;">
							Source of the estimate<br/>
							<span style="font-size:8pt; color:grey;">
							How where the dates arrived at?
							</span>
							<div style="margin:10px 25px;">
								<input type="radio" name="fDET"  value="0" checked="checked" />Unknown<br/>
								<input type="radio" name="fDET" value="1"/>Attested<br/>
								<input type="radio" name="fDET"  value="2"/>Conjecture<br/>
								<input type="radio" name="fDET"  value="3"/>Measurement
							</div>
						</div>

					</div>
				</div>
				<div id="c">
					<div style="margin:20px 0px 20px 50px;">
						Mean Date:
						<input type=text id="AVE" title="Enter date in  y-m-d h:m:s" style="width:80px; margin: 0px 5px" />
						<input type="radio" name="stdDev" value="sym" onclick="switchDev(false);" title="Symetric Deviation"
							checked="checked" style=" margin: 0px 10px 0px 0px"/>
						<u>+</u>&nbsp;
						<input type=text id="DEV" title="Enter duration in  PnYnMnDTnHnMnS format" style="width:50px; margin:0px 5px 0px 0px" />
						<span style="margin:0px 30px 0px 35px" >
							<input type="checkbox" id="COR"  />Corrected
						</span>
						<span title="Enter Lab Code">Lab Code:
							<input type=text id="COD" style="width:100px;" />
						</span><br/>
						<span style="margin:5px 10px 15px 78px; font-size:8pt; color:grey;"> Year's BP </span>
						<span style="margin:5px 0px 15px 68px; font-size:8pt; color:grey;">Std dev</span>
					</div>
					<div>
						<input type="radio" name="stdDev" value="asym" onclick="switchDev(true);" title="Asymetric Deviation"
							style=" margin: 0px 10px 0px 215px"/>
						<span title="Enter duration in  PnYnMnDTnHnMnS format">+
							<input type=text id="DVP" disabled style="width:50px; margin:0px 9px 0px 4px" />
						</span>
						<span title="Enter duration in  PnYnMnDTnHnMnS format">-
								<input type=text id="DVN" disabled style="width:50px; margin:0px 0px 0px 4px" />
						</span><br/>
						<span style="margin:5px 10px 15px 260px; font-size:8pt; color:grey;">Pos dev </span>
						<span style="margin:5px 0px 15px 20px; font-size:8pt; color:grey;">Neg dev</span>
					</div>
				</div>
			</div>
		</div>
		<div>
			<span style="margin:10px 270px">&nbsp;</span>
			<span>
				<input type="button" value="Save" onclick="TemporalPopup.close();" />
				<input type="button" value="Cancel" onclick="TemporalPopup.cancel();" />
			</span>
		</div>
		<div style="border-top:1px solid grey; margin :10px 10px"></div>
		<div style="margin: 10px 0px 0px 20px">
			<div>
				<span title="Enter comment for this temporal or " >Comment/original information:
					<input type=text id="COM" style="width:300px;" />
				</span>
			</div>
				<div style="margin:5px 0px 15px 175px; font-size:8pt; color:grey;"  >
					<span >Temporal objects are converted to a standard format.</span><br/>
					<span >This field is stored in the temporal to record the original values entered.</span>
				</div>
		</div>
		<script type="text/javascript" src="temporal.js"></script>
		<script type="text/javascript" src="../../external/jquery/jquery.js"></script>
		<script type="text/javascript">

			function switchDev (toAsym) {
				if (toAsym) {
					$("#DEV")[0].disabled = true;
					$("#DVP")[0].disabled = false;
					$("#DVN")[0].disabled = false;
					$("input[name=stdDEV][value=asym]").attr("checked","checked");
					$("input[name=stdDEV][value=sym]").attr("checked","");
				}else{
					$("#DEV")[0].disabled = false;
					$("#DVP")[0].disabled = true;
					$("#DVN")[0].disabled = true;
					$("input[name=stdDEV][value=asym]").attr("checked","");
					$("input[name=stdDEV][value=sym]").attr("checked","checked");
				}
			}
			var windowRef = document.parentWindow  ||  document.defaultView  ||  this.document._parentWindow;
			var popupOptions = {
				callback: function(date) {
					if (date) {
						document.getElementById("simpleDate").value = date;
					}
				},
				"close-on-blur": true,
				"no-titlebar": true,
				"no-resize": true
			};

			function calendarPopup(buttonElt) {
				var buttonPos = top.HEURIST.getPosition(buttonElt, true);
				popupOptions.x = buttonPos.x + 8 - 120;
				popupOptions.y = buttonPos.y + 8 - 80;

				top.HEURIST.util.popupURL(windowRef, top.HEURIST.basePath + "common/lib/calendar.html#"+
					document.getElementById("simpleDate").value, popupOptions);
			}

			function setPDBtoTPQ () {
				var tpq = document.getElementById("TPQ");
				var pdb = document.getElementById("PDB");
				if (typeof tpq == "object" && typeof pdb == "object" && tpq.value) {
					pdb.value = tpq.value
				}
			}

			function setPDEtoTAQ () {
				var taq = document.getElementById("TAQ");
				var pde = document.getElementById("PDE");
				if (typeof taq == "object" && typeof pde == "object" && taq.value) {
					pde.value = taq.value
				}
			}

			function dRangeDraw() {
				var canvas = document.getElementById("dRangeCanvas");
				if (canvas.getContext) {
					var ctx = canvas.getContext("2d");

					ctx.fillStyle = "rgb(150,150,150)";
					ctx.fillRect (135, 0, 260, 60);
					var lingrad = ctx.createLinearGradient(75,0,135,0);
					lingrad.addColorStop(0, 'rgba(0,0,150,0)');
					lingrad.addColorStop(0.5, 'rgba(75,75,150,0.5)');
					lingrad.addColorStop(1, 'rgba(150,150,150,0.9)');
					var lingrad2 = ctx.createLinearGradient(455,0,395,0);
					lingrad2.addColorStop(0, 'rgba(0,0,150,0)');
					lingrad2.addColorStop(0.5, 'rgba(75,75,150,0.5)');
					lingrad2.addColorStop(1, 'rgba(150,150,150,0.9)');

					ctx.fillStyle = lingrad;
					ctx.fillRect (75, 0, 60, 60);
					ctx.fillStyle = lingrad2;
					ctx.fillRect (395, 0, 60, 60);
					ctx.beginPath();
					ctx.fillStyle = "rgba(0, 0, 200, 0.2)";
					ctx.lineWidth = 5;
					ctx.strokeStyle = "#808080";
					ctx.moveTo(0,62.5);
					ctx.lineTo(530,62.5);
					ctx.moveTo(75.5,0);
					ctx.lineTo(75.5,62.5);
					ctx.moveTo(135.5,0);
					ctx.lineTo(135.5,62.5);
					ctx.moveTo(395.5,0);
					ctx.lineTo(395.5,62.5);
					ctx.moveTo(455.5,0);
					ctx.lineTo(455.5,62.5);
					ctx.stroke();
					ctx.beginPath();
					ctx.fillStyle = "rgb(50,50,50)";
					ctx.font = "8pt Arial";
					drawLabel(ctx,"TPQ",75,80,20);
					drawLabel(ctx,"PB",135,80,20);
					drawLabel(ctx,"PE",395,80,20);
					drawLabel(ctx,"TAQ",455,80,20);
					ctx.fillStyle = "rgb(250,250,250)";
					ctx.font = "12pt Arial Bold";
					drawLabel(ctx,"likely range",265,40,60);
					ctx.stroke();
				}
			}

			function drawLabel ( ctx, label, xPos, yPos, maxX) {
				var pxLen = ctx.measureText(label).width;
				ctx.fillText(label, xPos - pxLen/2, yPos, maxX);
			}

			var TemporalPopup = (function () {
				//private members
				var _className = "Applet";  // I know this is a singleton and the application object, but hey it matches the pattern.
				var _tabView;
				var _type2TabIndexMap = {};

				function _init () {
					if (location.search.length > 1) {		// the calling app passed a parameter string - save it
						that.originalInputString = unescape(location.search.substring(1));
					}
					if ( Temporal.isValidFormat(that.originalInputString)) {
						try {
							that.origTemporal = Temporal.parse(that.originalInputString);
						}
						catch (e) {
							return "Error creating temporal from valid input string : " + that.originalInputString + " : " + e;
						}
					} else if (that.originalInputString) { // non temporal non empty string
						try {
								var tDate = TDate.parse(that.originalInputString);
								that.origTemporal = new Temporal();
								that.origTemporal.setType("s");  // simple date
								that.origTemporal.setTDate("DAT",tDate);
								that.origTemporal.setField("COM",that.originalInputString);
							}
							catch(e) { // unknown string
								that.origTemporal = new Temporal();
								that.origTemporal.setType("s");  // simple date with no date
								that.origTemporal.setField("COM",that.originalInputString);
							}
					} else { // empty string
						that.origTemporal = new Temporal();
						that.origTemporal.setType("s");  // simple date with no data
					}
					// set current temporal to original
					try {
						that.curTemporal = new Temporal(that.origTemporal.toString());  //FIXME should add a clone function to the temporal library
					}
					catch(e) {
						that.curTemporal = new Temporal();
						that.curTemporal.setType("s");  // simple date with no date
						that.curTemporal.setField("COM",that.originalInputString);
					}
					// set display
					_tabView = new YAHOO.widget.TabView('display-div');

					// set up temporal type to tab index mapping
					var tabs = _tabView.getAttributeConfig("tabs").value;
					for (var i=0; i < tabs.length; i++) {
						var type = tabs[i].getAttributeConfig("contentEl").value.id;
						_type2TabIndexMap[type] = i;
					}

					// select the tab for the initial temporal's type and change the label to show the user this is where things started
					_tabView.selectTab(_type2TabIndexMap[that.curTemporal.getType()]);
					var activeTab = _tabView.get("activeTab");
					activeTab.set("label", "<i>" + activeTab.get("label") + "</i>", false);
					_updateUIFromTemporal(that.curTemporal);
					_tabView.on('beforeActiveTabChange', function (ev) {
						var curType = ev.prevValue._configs.contentEl.value.id,
							newType = ev.newValue._configs.contentEl.value.id;
						// grab all the data from the current tab using the
						_updateTemporalFromUI(that.curTemporal);
						that.curTemporal.setType(newType);
						_updateUIFromTemporal(that.curTemporal);
						return;} );
					dRangeDraw();
				};


				function _updateUIFromTemporal (temporal) {
					var type = temporal.getType();
					if (!type) {
						return;
					}
					if (type === "s") {
						var tDate = temporal.getTDate("DAT");
						// if DAT then separate Date, Time and TimeZone
						if (tDate) {
							$("#simpleDate").val(tDate.toString("yy-MM-dd"));
							$("#simpleTime").val(tDate.toString("HH:mm:ss"));
							$("#tzone").val(tDate.toString("z"));
						}
					}
					var fields = Temporal.getFieldsForType(type);
					for(var i =0; i< fields.length; i++) {
						var code = fields[i];
						var val = temporal.getStringForCode(code);
						var elem = $( "#" + type + code);
						if (elem.length == 0) {
							elem = $("#" + code);
						}
						if (elem.length == 0) {
							elem = $("input[name=" + type + code + "]:checked");
						}
						if (elem.length != 0) {
							switch (elem[0].type) {
								case "checkbox" :
									if (val) {
										elem.attr("checked","checked");
									}
									break;
								case "radio" :
									if (val) {
										elem.attr("checked","");
										elem = $("input[name=" + type + code + "][value=" + val + "]");
										elem.attr("checked","checked");
									}
									break;
								case "select-one" :
									if (val) {
										elem.val(val);
									}
									break;
								default :
									elem.val(val);
							}
						}
					}
					if (type === "c" && val) {
						if (code === "DEV") {
							$("input[name=stdDEV][value=asym]").attr("checked","");
							$("input[name=stdDEV][value=sym]").attr("checked","checked");
						}else if (code === "DVP") {
							$("input[name=stdDEV][value=sym]").attr("checked","");
							$("input[name=stdDEV][value=asym]").attr("checked","checked");
						}
					}
				};

				function _updateTemporalFromUI (temporal) {
					var type = temporal.getType();
					var fields = Temporal.getFieldsForType(type);
					for(var i =0; i< fields.length; i++) {
						var code = fields[i];
						var elem = $( "#" + type + code);
						if (elem.length == 0) {
							elem = $("#" + code);
						}
						if (elem.length == 0) {
							elem = $("input[name=" + type + code + "]:checked");  //radio button group
						}
						if (elem.length != 0) {
							switch (elem[0].type) {
								case "checkbox" :
									if (elem.attr("checked")) {
										temporal.addObjForString(code, "1");
									}else {
										temporal.removeObjForCode(code);
									}
									break;
								default :
									if (elem.val()) {
										temporal.addObjForString(code, elem.val());  // FIXME  this should validate input from the user.
									}else if (elem.length != 0) {
										temporal.removeObjForCode(code);
									}
							}
						}
					}
					if (type === "s") {
						var strDate = ($("#simpleTime").val());
						if (strDate && $("#tzone").val()) {
							var zone = $("#tzone").val().match(/^\s*(?:UTC|GMT)?\s*([\+|\-]?\d?\d:?(?:\d\d)?)?/)[1];
							if (zone) {
								strDate += " " + zone;
							}
						}
						strDate = 	$("#simpleDate").val() + " " + strDate;
						temporal.addObjForString("DAT", strDate);
					}
				};

				//public members
				var that = {
						originalInputString : "",
						origTemporal : null,
						curTemporal : null,
						name : "App",
						getTabView : function () {
							return _tabView;
						},
						close : function () {
							_updateTemporalFromUI(that.curTemporal);
							var validity = Temporal.checkValidity(that.curTemporal);
							if (validity[0]) {  // valid temporal
								if (validity[2]) { //some extra code fields, so remove them
									for (var i=0; i<validity[2].length; i++) {
										that.curTemporal.removeObjForCode(validity[2][i]);
									}
								}
								window.close( that.curTemporal.toString());
							}else{
								var msg = validity[1].join(',');
								msg = msg ? "The current temporal is missing the" + msg + " value(s)." : "";
								msg +=  validity[3] ? " " + validity[3] : "";
								if (!confirm( msg +
										"Would you like to continue working? Press cancel to reset to the original string.")) {
									window.close(that.originalInputString);
								}else{
									window.close();
								}
							}
						},
						cancel : function () {
							window.close(that.originalInputString);
						},
						getClass : function () {
							return _className;
						},
						isA: function(strClass) {
							if(strClass === _className) return true;
							return false;
						}
				};

				_init();
				return that;
			})();

		</script>
	</body>
</html>

